name: Issue Cleaner

on:
  issue_comment:
    types: [created]

jobs:
  clean-comments:
    if: contains(github.event.comment.body, '@lousybot clear')
    runs-on: ubuntu-latest
    permissions:
      issues: write

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Clean issue comments
      uses: actions/github-script@v7
      with:
        script: |
          const issueNumber = context.issue.number;
          const comments = await github.rest.issues.listComments({
            owner: context.repo.owner,
            repo: context.repo.repo,
            issue_number: issueNumber
          });

          for (const comment of comments.data) {
            if (comment.body.includes('@lousybot') || comment.user.login === 'github-actions[bot]') {
              await github.rest.issues.deleteComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                comment_id: comment.id
              });
            }
          }
